<link rel="import" href="/static/components/polymer/polymer.html">
<link rel="import" href="/static/components/core-ajax/core-ajax.html">
<link rel="import" href="/static/components/paper-input/paper-input.html">
<link rel="import" href="/static/components/paper-button/paper-button.html">

<polymer-element name="register-form">
    <template>
        <style>
            :host {
                display: block;
            }
            #loginBut {
                background: #4285f4;
                color: #fff;
                padding: 5px 10px;
                margin-right: 15px;;
            }
            .error {
                color:red;
            }
        </style>
        <core-ajax id='coreAjaxForm'
                   method='post'
                   contentType='application/json'
                   url='/register/'
                   on-core-response='{{ register }}'
                   response='{{ response }}'
                   handleAs='json'
                   body='{"username":"{{ username }}", "password":"{{ password }}", "email":"{{ email }}", "confirm":"{{ confirm }}"}'>
        </core-ajax>
        <template repeat='{{ error in response.errors }}'>
            <span class='error'>{{ error.message }}</span>
            <br>
        </template>
        <div class='registerDiv' layout vertical center>
            <paper-input label='Username' name='username' floatingLabel value='{{ username }}'></paper-input>
            <paper-input label='Email' name='email' type='email' floatingLabel value='{{ email }}'></paper-input>
            <paper-input-decorator label="Password">
                <input id="password" is="core-input" name="password" type="password" value="{{password}}"/>
            </paper-input-decorator>
            <paper-input-decorator label="Confirm password">
                <input id="password" is="core-input" name="confirm_password" type="password" value="{{confirm}}"/>
            </paper-input-decorator>
            <paper-button name='register' id='loginBut' on-click='{{ submit }}'>Register</paper-button>
        </div>
    </template>
    <script>
        Polymer('register-form', {
            submit: function () {
                this.$.coreAjaxForm.go();
            },
            register: function () {
                if (this.response.registered) {
                    window.location.href = "/login/";
                }
            }
        });
    </script>
</polymer-element>
