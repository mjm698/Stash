<link rel="import" href="/static/components/polymer/polymer.html">
<link rel="import" href="/static/components/core-ajax/core-ajax.html">
<link rel="import" href="content-element.html">

<polymer-element name="content-list" attributes="stashId userId newContent">
    <template>
        <style>
            :host { }
            content-element {
                margin-top: 10px;
                padding-left: 15px;
            }
        </style>
        <core-ajax id="getContent"
                   method="get"
                   url="/content/"
                   headers='{"USERID":"{{ userId }}",
                             "STASHID": "{{ stashId }}"}'
                   params='{"stashId":"{{ stashId}}"}'
                   response="{{data}}"
                   handleAs="json">
        </core-ajax>
        <div layout vertical center>
            <template repeat="{{content in data}}">
                <content-element data={{content}} userId={{userId}}></content-element>
            </template>
        </div>
    </template>
    <script>
        Polymer({ 
            ready: function()
            {
                this.addEventListener('hideContent', this.hideContent)
                this.addEventListener('addNewContent', this.addNewContent)
            },
            hideContent: function(e)
            {
                for(var index = 0; index < this.data.length; ++index)
                {
                    if(e.detail.id == this.data[index].id)
                    {
                        this.data.splice(index, 1);
                        break;
                    }
                }
            },
            stashIdChanged: function(oldValue, newValue)
            {
                console.log('changed');
                this.$.getContent.go();
            },
            newContentChanged: function(oldValue, newValue)
            {
                if(newValue)
                {
                    this.data.push(newValue);
                }
            }
        });
    </script>
</polymer-element>
