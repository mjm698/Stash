<link rel="import" href="/static/components/polymer/polymer.html">
<link rel="import" href="/static/components/core-ajax/core-ajax.html">
<link rel="import" href="/static/components/paper-input/paper-input.html">
<link rel="import" href="/static/components/paper-button/paper-button.html">
<link rel="import" href="/static/components/paper-input/paper-input-decorator.html">

<polymer-element name="login-form">
    <template>
        <style>
            :host {
                display: block;
            }
            #loginBut {
                background: #4285f4;
                color: #fff;
                padding: 5px 10px;
                margin-right: 15px;;
            }
            .error {
                color:red;
            }
        </style>
        <core-ajax id="postLogin"
                   auto="false"
                   method="post"
                   contentType="application/json"
                   url="/login/"
                   on-core-response="{{loggedIn}}"
                   response="{{response}}"
                   body='{"username":"{{username}}", "password":"{{password}}"}'
                   handleAs="json">
        </core-ajax>
        <template repeat="{{error in response.errors}}">
            <span class="error">{{error.message}}</span>
            <br>
        </template>
        <div class="registerDiv" layout vertical center>
            <paper-input label="Username" name="username" value="{{username}}"></paper-input>
            <paper-input-decorator label="Password">
                <input id="password" is="core-input" name="password" type="password" value="{{password}}"/>
            </paper-input-decorator>
            <paper-button name="login" type="submit" id="loginBut" on-click="{{submit}}">Login</paper-button>
        </div>
    </template>
    <script>
        Polymer({
            submit: function() 
            {
                this.$.postLogin.go();
            }, 
            loggedIn: function() {
                if(this.response.login) 
                {
                    console.log('redirecting i think');
                    window.location.href = "/";
                }
            }
        });
    </script>
</polymer-element>
